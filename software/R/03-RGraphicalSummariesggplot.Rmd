##### `ggplot` Plotting  
Now that we've covered `Base R` plotting, we'll look at plotting through `ggplot2` (sort of part of the tidyverse - [Cheat Sheet](https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=2&cad=rja&uact=8&ved=2ahUKEwjFu_ep-rroAhXnknIEHf13Bq4QFjABegQICBAB&url=https%3A%2F%2Frstudio.com%2Fwp-content%2Fuploads%2F2016%2F11%2Fggplot2-cheatsheet-2.1.pdf&usg=AOvVaw1-6jSR5VfWs7V62OYxtDtG)).  The main idea is outlined below:

- `ggplot(data = data_frame)` creates a plot instance  
- Add "layers" to the system (geoms or stats)  
    + Creates a visualization of the data  
- Modify layer "mapping" args (aes)
    + Ex: size, color, and x, y location(s)  
- Coordinate system (mostly use Cartesian plane)  
- Optional: Titles, etc.

We'll go through creation of the same plots in the `Base R` section.  

To create a barplot we can use `ggplot + geom_bar`.    

- Ex: Data on titanic passengers in `titanic.csv`

```{r,echo=FALSE}
titanicData <- read_csv("datasets/titanic.csv")
#convert survival status to a factor
titanicData$survived <- as.factor(titanicData$survived)
titanicData
```


 `ggplot2` Plotting: Categorical variables  

Categorical variable - entries are a label or attribute   

- Barplots via `ggplot + geom_bar`  

- Across x-axis we want our categories - specify with `aes(x = ...)`

```{r, eval=TRUE, out.width = "450px", fig.align='center'}
ggplot(data = titanicData, aes(x = survived))
```


 `ggplot2` Plotting: Categorical variables  

Categorical variable - entries are a label or attribute   

- Barplots via `ggplot + geom_bar`  

- Must add geom (or stat) layer!

```{r,eval=TRUE, out.width = "450px", fig.align='center'}
ggplot(data = titanicData, aes(x = survived)) + geom_bar()
```



 `ggplot2` Plotting: Categorical variables  

- Generally: Save base object, then "add layers"  

```{r,eval = FALSE, out.width = "450px", fig.align='center'}
g <- ggplot(data = titanicData, aes(x = survived))
g + geom_bar()
```


 `ggplot2` Plotting: Categorical variables  

- Generally: Save base object, then "add layers"  

```{r,eval = FALSE, out.width = "450px", fig.align='center'}
g <- ggplot(data = titanicData, aes(x = survived))
g + geom_bar()
```

- `aes()` defines visual properties of objects in the plot  

&nbsp; &nbsp; &nbsp; &nbsp; `x = , y = , size = , shape = , color = , alpha = , ...` 

-  [Cheat Sheet](https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=2&cad=rja&uact=8&ved=2ahUKEwjFu_ep-rroAhXnknIEHf13Bq4QFjABegQICBAB&url=https%3A%2F%2Frstudio.com%2Fwp-content%2Fuploads%2F2016%2F11%2Fggplot2-cheatsheet-2.1.pdf&usg=AOvVaw1-6jSR5VfWs7V62OYxtDtG) gives most common properties for a given `geom`  


 `ggplot2` Plotting: Categorical variables  

- Generally: Save base object, then "add layers"  

```{r,eval = FALSE, out.width = "450px", fig.align='center'}
g <- ggplot(data = titanicData, aes(x = survived))
g + geom_bar()
```

- `aes()` defines visual properties of objects in the plot  

&nbsp; &nbsp; &nbsp; &nbsp; `x = , y = , size = , shape = , color = , alpha = , ...`

-  [Cheat Sheet](https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=2&cad=rja&uact=8&ved=2ahUKEwjFu_ep-rroAhXnknIEHf13Bq4QFjABegQICBAB&url=https%3A%2F%2Frstudio.com%2Fwp-content%2Fuploads%2F2016%2F11%2Fggplot2-cheatsheet-2.1.pdf&usg=AOvVaw1-6jSR5VfWs7V62OYxtDtG) gives most common properties for a given `geom`  

&nbsp; &nbsp; &nbsp; &nbsp; `d + geom_bar()`  

&nbsp; &nbsp; &nbsp; &nbsp; `x, alpha, color, fill, linetype, size, weight`
    


 `ggplot2` Plotting: Categorical variables  
 
`data` and `aes` can be set in two ways;

- 'globally' (for all layers) via the `ggplot` statement  

- 'locally' (for just that layer) via the `geom`, `stat`, etc. layer


 `ggplot2` Plotting: Categorical variables  
 
`data` and `aes` can be set in two ways;

- 'globally' (for all layers) via the `ggplot` statement  

- 'locally' (for just that layer) via the `geom`, `stat`, etc. layer

```{r,eval = FALSE, out.width = "450px", fig.align='center'}
#global 
ggplot(data = titanicData, aes(x = survived)) + geom_bar()
#local 
ggplot() + geom_bar(data = titanicData, aes(x = survived))
```



 `ggplot2` Plotting: Categorical variables  
 
`data` and `aes` can be set in two ways;

- 'globally' (for all layers) via the `ggplot` statement  

- 'locally' (for just that layer) via the `geom`, `stat`, etc. layer

```{r,eval = FALSE, out.width = "450px", fig.align='center'}
#global 
ggplot(data = titanicData, aes(x = survived)) + geom_bar()
#local 
ggplot() + geom_bar(data = titanicData, aes(x = survived))
```

- To set an attribute that doesn't depend on the data (i.e. `color = 'blue'`), generally place these outside of the `aes`  


 `ggplot2` Plotting: Categorical variables  
 
- Improve plot by removing `NA` category  

```{r,eval = TRUE, out.width = "450px", fig.align='center'}
titanicData <- titanicData %>% drop_na(survived, sex, embarked)
g <- ggplot(data = titanicData, aes(x = survived))
g + geom_bar()
```



 `ggplot2` Plotting: Categorical variables  
 
- Add better labels and a title (new layers, see cheat sheet!)  

```{r,eval = TRUE, out.width = "450px", fig.align='center'}
ggplot(data = titanicData, aes(x = as.character(survived))) + 
  geom_bar() + 
  labs(x = "Survival Status", title = "Bar Plot of Survival for Titanic Passengers") + 
  scale_x_discrete(labels = c("Died", "Survived"))
```



 `ggplot2` Plotting: Categorical variables  
 
Categorical variable - entries are a label or attribute   

- **Stacked barplot** created by via `fill` aesthetic and same process
    
    + Create base object  
    + Add geoms  
    + Use aes to specify aspects of the plot  


     
 `ggplot2` Plotting: Categorical variables  
 
Categorical variable - entries are a label or attribute   

- **Stacked barplot** created by via `fill` aesthetic

- Automatic assignment of colors, creation of legends, etc. for `aes` elements (except with `group`)

```{r,eval = TRUE, out.width = "450px", fig.align='center'}
ggplot(data = titanicData, aes(x = survived, fill = sex)) + geom_bar()
```


 `ggplot2` Plotting: Categorical variables  

- Add custom labels by adding more layers

```{r,eval = TRUE, out.width = "450px", fig.align='center'}
ggplot(data = titanicData, aes(x = survived, fill = sex)) + 
  geom_bar() +
  labs(x = "Survival Status", 
       title = "Bar Plot of Survival Status for Titanic Passengers") + 
  scale_x_discrete(labels = c("Died", "Survived")) + 
  scale_fill_discrete(name = "Sex", labels = c("Female","Male"))
```



 `ggplot2` Plotting: Categorical variables  

- Adjusting appropriate labeling via `scale_*_discrete`


`aes(x = survived, fill = sex)` 

`scale_x_discrete(labels = c("Died", "Survived"))`

`scale_fill_discrete(name = "Sex", labels = c("Female","Male"))`




 `ggplot2` Plotting: Categorical variables  

- Easy to rotate a plot with `coord_flip`  

```{r,eval = TRUE, out.width = "450px", fig.align='center'}
ggplot(data = titanicData, aes(x = survived, fill = sex)) + geom_bar() +
  labs(x = "Survival Status", 
       title = "Bar Plot of Survival Status for Titanic Passengers") + 
  scale_x_discrete(labels = c("Died", "Survived")) + 
  scale_fill_discrete(name = "Sex", labels = c("Female","Male")) + 
  coord_flip()
```



 `ggplot2` Plotting: Categorical variables  

Note: Most geoms have a corresponding stat that can be used  

`geom_bar(mapping = NULL, data = NULL, stat = "count",
  position = "stack", ..., width = NULL, binwidth = NULL, na.rm = FALSE,
  show.legend = NA, inherit.aes = TRUE)`
  
- Equivalent plots via:

```{r,eval=FALSE,echo=TRUE}
ggplot(data = titanicData, aes(x = survived, fill = sex)) + geom_bar()
ggplot(data = titanicData, aes(x = survived, fill = sex)) + stat_count() ```
```


 `ggplot2` Plotting: Categorical variables  

Note: Most geoms have a corresponding stat that can be used  

- Can modify the stat: if you have summary data, use `identity`  
  
```{r,eval = TRUE, out.width = "450px", fig.align='center'}
sumData <- titanicData %>% group_by(survived, sex) %>% summarize(count = n())
ggplot(sumData, aes(x = survived, y = count, fill = sex)) + 
  geom_bar(stat = "identity")
```



 `ggplot2` Plotting: Categorical variables  

Categorical variable - entries are a label or attribute   

- **Side-by-side barplot** created by via `position` aesthetic

    + `dodge` for side-by-side bar plot  
    + `jitter` for continuous data with many points at same values  
    + `fill` stacks bars and standardises each stack to have constant height  
    + `stack` stacks bars on top of each other


 `ggplot2` Plotting: Categorical variables  

Categorical variable - entries are a label or attribute   

- **Side-by-side barplot** created by via `position` aesthetic

```{r,eval = TRUE, out.width = "450px", fig.align='center'}
ggplot(data = titanicData, aes(x = survived, fill = sex)) + 
  geom_bar(position = "dodge")
```


 `ggplot2` Plotting: Categorical variables  

Categorical variable - entries are a label or attribute   
  
 - `position = fill` stacks bars and standardises each stack to have constant height (especially useful with equal group sizes)  

```{r,eval = TRUE, out.width = "450px", fig.align='center'}
ggplot(data = titanicData, aes(x = survived, fill = sex)) + 
  geom_bar(position = "fill")
```


 `ggplot2` Plotting: Categorical variables  

How to create same plot for each `embarked` value?  Use **faceting**!



 `ggplot2` Plotting: Categorical variables  

How to create same plot for each `embarked` value?  Use **faceting**!

`facet_wrap(~ var)` - creates a plot for each setting of `var`  

- Can specify `nrow` and `ncol` or let R figure it out



 `ggplot2` Plotting: Categorical variables  

How to create same plot for each `embarked` value?  Use **faceting**!

`facet_wrap(~ var)` - creates a plot for each setting of `var`  

- Can specify `nrow` and `ncol` or let R figure it out

`facet_grid(var1 ~ var2)` - creats a plot for each combination of `var1` and `var2`  

- `var1` values across rows

- `var2` values across columns

- Use `. ~ var2` or `var1 ~ .` to have only one row or column  


 `ggplot2` Plotting: Categorical variables  

How to create same plot for each `embarked` value?  Use **faceting**!

- `facet_wrap(~ var)` - creates a plot for each setting of `var`  

```{r,eval = TRUE, out.width = "450px", fig.align='center'}
ggplot(data = titanicData, aes(x = survived)) + 
  geom_bar(aes(fill =sex), position = "dodge") +
  facet_wrap(~ embarked)
```


 `ggplot2` Plotting: Categorical variables  

How to create same plot for each `pclass` and `embarked` combination?  

- `facet_grid(var1 ~ var2)` - creats a plot for each combination of `var1` and `var2` 

```{r,eval = TRUE, out.width = "450px", fig.align='center'}
ggplot(data = titanicData, aes(x = survived)) + 
  geom_bar(aes(fill =sex), position = "dodge") +
  facet_grid(pclass ~ embarked)
```



 `ggplot2` Plotting: Categorical variables  

Recap!  

Categorical variable - entries are a label or attribute   

- Most common plot is barplot: `ggplot + geom_bar(aes(x = ...))`  
    
- With summary data, use `geom_bar(stat = identity)`  

- Stacked barplot via `aes(fill = )`

- Side-by-side barplot via `position = dodge`  

- Filled barplot via `position = fill`  


 `ggplot2` Plotting Recap

General `ggplot` things:

- Can set local or global `aes`

- Modify titles/labels by adding more layers

- Use either stat or geom layer

- Faceting (multiple plots) via `facet_grid` or `facet_wrap`

- Only need `aes` if setting a mapping value that is dependent on the data (or you want to create a custom legend!)  


 `ggplot2` Plotting Recap

General `ggplot` things:

- Can set local or global `aes`

- Modify titles/labels by adding more layers

- Use either stat or geom layer

- Faceting (multiple plots) via `facet_grid` or `facet_wrap`

- Only need `aes` if setting a mapping value that is dependent on the data (or you want to create a custom legend!)  

Next:  Numerical variable plotting




 `ggplot2` Plotting: Numerical Variables    

Numerical variable - entries are a numerical value where math can be performed

Goal: describe the shape, center, and spread

- Generally, via a histogram or boxplot!  

Same process:
    
- Create base object  
- Add geoms  
- Use aes to specify aspects of the plot  


 `ggplot2` Plotting: Numerical Variables    


- Look at carbon dioxide (CO2) uptake data set  

    + Response recorded: `uptake` CO2 uptake rates in grass plants  
    + Environment manipulated: `Treatment` - chilled/nonchilled  
    + Ambient CO2 specified and measured: `conc`  
    
```{r}
CO2 <- tbl_df(CO2)
CO2
```


 `ggplot2` Plotting: Numerical Variables    

Numerical variable - entries are a numerical value where math can be performed

- **Histogram** - Bins data to show distribution of observations

- Common `aes` values (from cheat sheet):

&nbsp; &nbsp; &nbsp; &nbsp; `c + geom_histogram(binwidth = 5)`

&nbsp; &nbsp; &nbsp; &nbsp; `x, y, alpha, color, fill, linetype, size, weight`

> - only `x` is really needed


 `ggplot2` Plotting: Numerical Variables    

Numerical variable - entries are a numerical value where math can be performed

- **Histogram** - Bins data to show distribution of observations

```{r,eval = TRUE, out.width = "450px", fig.align='center'}
g <- ggplot(CO2, aes(x = uptake))
g + geom_histogram()
```


 `ggplot2` Plotting: Numerical Variables    

Numerical variable - entries are a numerical value where math can be performed

- **Histogram** - Bins data to show distribution of observations

- Attributes of the plot not dependent on data generally set outside of `aes`  

```{r,eval = TRUE, out.width = "450px", fig.align='center'}
g + geom_histogram(color = "blue", fill = "red", size = 2, binwidth = 3)
```


 `ggplot2` Plotting: Numerical Variables    

Numerical variable - entries are a numerical value where math can be performed

- **Kernel Smoother** - Smoothed version of a histogram  

- 'Kernel' determines weight given to nearby points    

```{r, echo = FALSE, out.width = "500px", fig.align='center'}
knitr::include_graphics("img/kernel.png")
```


 `ggplot2` Plotting: Numerical Variables    

Numerical variable - entries are a numerical value where math can be performed

- **Kernel Smoother** - Smoothed version of a histogram  

- Common `aes` values (from cheat sheet):

&nbsp; &nbsp; &nbsp; &nbsp; `c + geom_density(kernel = "gaussian")`  

&nbsp; &nbsp; &nbsp; &nbsp; `x, y, alpha, color, fill, group, linetype, size, weight`

> - Only `x =` is really needed


 `ggplot2` Plotting: Numerical Variables    

- **Kernel Smoother** - Smoothed version of a histogram  

```{r, echo = TRUE, out.width = "500px", fig.align='center'}
ggplot(CO2, aes(x = uptake)) + geom_density()
```



 `ggplot2` Plotting: Numerical Variables    

- **Kernel Smoother** - Smoothed version of a histogram  

- `fill` a useful aesthetic! 

```{r, echo = TRUE, out.width = "500px", fig.align='center'}
ggplot(CO2, aes(x = uptake)) +
  geom_density(adjust = 0.5, alpha = 0.5, aes(fill = Treatment))
```



 `ggplot2` Plotting: Numerical Variables    

- **Kernel Smoother** - Smoothed version of a histogram  

- recall `position` choices of `dodge`, `jitter`, `fill`, and `stack`

```{r, echo = TRUE, out.width = "500px", fig.align='center'}
ggplot(CO2, aes(x = uptake)) + 
  geom_density(adjust = 0.5, alpha = 0.5, position = "stack", aes(fill = Treatment))
```



 `ggplot2` Plotting: Numerical Variables    

- **Histogram + Kernel Smoother**

- Just add both layers!  (Works for any compatible layers)  

- Use `y = ..density..` to put histogram on same scale  


 `ggplot2` Plotting: Numerical Variables    

- **Histogram + Kernel Smoother**

```{r, echo = TRUE, out.width = "500px", fig.align='center'}
ggplot(CO2) + 
  geom_histogram(aes(y = ..density.., x = uptake, fill = Treatment)) +
  geom_density(adjust = 0.25, alpha = 0.5, position = "stack", 
               aes(x = uptake, fill = Treatment)) 
```


 `ggplot2` Plotting: Numerical Variables    

- **Histogram + Kernel Smoother**

- Better to set global `aes()` options here!  

- Can easily change `fill` variable for all layers

```{r,eval=FALSE,echo=TRUE,message=FALSE}
ggplot(CO2, aes(x = uptake, fill = Treatment)) + 
  geom_histogram(aes(y = ..density..)) +
  geom_density(adjust = 0.25, alpha = 0.5, position = "stack")
```


 `ggplot2` Plotting: Numerical Variables    

One numerical and one categorical variable

- **Boxplot** - Provides the five number summary in a graph

    - Min, Q1, Median, Q3, Max  
    - Often show possible outliers as well  



 `ggplot2` Plotting: Numerical Variables    

One numerical and one categorical variable

- **Boxplot** - Provides the five number summary in a graph

- Common `aes` values (from cheat sheet):

&nbsp; &nbsp; &nbsp; &nbsp; `f + geom_boxplot()`

&nbsp; &nbsp; &nbsp; &nbsp; `x, y, lower, middle, upper, ymax, ymin, alpha, color, fill, group, linetype, shape, size, weight`

> - Only `x =, y =` are really needed  


 `ggplot2` Plotting: Numerical Variables    

One numerical and one categorical variable

- **Boxplot** - Provides the five number summary in a graph

```{r, echo = TRUE, out.width = "500px", fig.align='center'}
g <- ggplot(CO2, aes(x = Treatment, y = uptake))
g + geom_boxplot(fill = "grey")
```



 `ggplot2` Plotting: Numerical Variables    


- **Boxplot** - Provides the five number summary in a graph

- Can add data points (jittered) to see shape of data better

```{r, echo = TRUE, out.width = "500px", fig.align='center'}
ggplot(CO2, aes(x = Treatment, y = uptake)) + 
  geom_boxplot(fill = "grey") +
  geom_jitter(width = 0.1)
```


 `ggplot2` Plotting: Numerical Variables    


- **Boxplot** - Provides the five number summary in a graph

- Order of layers important!

```{r, echo = TRUE, out.width = "500px", fig.align='center'}
ggplot(CO2, aes(x = Treatment, y = uptake)) + 
  geom_jitter(width = 0.1) + 
  geom_boxplot(fill = "grey")
```


 `ggplot2` Plotting: Numerical Variables    

- **Boxplot** - Provides the five number summary in a graph

- Can `facet` easily!

```{r, echo = TRUE, out.width = "500px", fig.align='center'}
ggplot(CO2, aes(x = Treatment, y = uptake)) + geom_boxplot(fill = "grey") +
  geom_jitter(width = 0.1) + facet_wrap(~ Type)
```




 `ggplot2` Plotting: Numerical Variables    

Two numerical variables

- **Scatter Plot** - graphs points corresponding to each observation

- Common `aes` values (from cheat sheet):

&nbsp; &nbsp; &nbsp; &nbsp; `e + geom_point()`

&nbsp; &nbsp; &nbsp; &nbsp; `x, y, alpha, color, fill, shape, size, stroke`

> - Only `x =, y =` are really needed  



 `ggplot2` Plotting: Numerical Variables    

Two numerical variables

- **Scatter Plot** - graphs points corresponding to each observation

```{r, echo = TRUE, out.width = "500px", fig.align='center'}
g <- ggplot(CO2, aes(x = conc, y = uptake)) 
g + geom_point()
```



 `ggplot2` Plotting: Numerical Variables    

- Add trend lines easily (linear and loess - a smoother) 

```{r, echo = TRUE, out.width = "500px", fig.align='center'}
ggplot(CO2, aes(x = conc, y = uptake)) + geom_point() +  
  geom_smooth(aes(col = "loess")) +
  geom_smooth(method = lm, aes(col = "linear")) + 
  scale_colour_manual(name = 'Smoother', values =c('loess'='purple','linear'='red'), 
                      labels = c('GAM','Linear'), guide = 'legend')
```



 `ggplot2` Plotting: Numerical Variables    

- May want to add value of correlation to plot  

- `paste()` or `paste0()` handy

```{r}
paste("Hi", "What", "Is", "Going", "On", "?", sep = " ")
paste("Hi", "What", "Is", "Going", "On", "?", sep = ".")
paste0("Hi", "What", "Is", "Going", "On", "?")
```


 `ggplot2` Plotting: Numerical Variables    

```{r, echo = TRUE, out.width = "500px", fig.align='center'}
correlation <- cor(CO2$conc, CO2$uptake)
ggplot(CO2, aes(x = conc, y = uptake)) + geom_point() +
  geom_smooth(method = lm, col = "Red") + 
  geom_text(x = 750, y = 10, size = 5, 
            label = paste0("Correlation = ", round(correlation, 2)))
```


 `ggplot2` Plotting: Numerical Variables

- **Scatter Plot**

- Text for points with `geom_text`  

```{r, echo = TRUE, out.width = "500px", fig.align='center'}
ggplot(CO2, aes(x = conc, y = uptake)) + 
  geom_text(aes(label = Plant))
```


 `ggplot2` Plotting: Numerical Variables

- Easily facet! (Note: `cut()` is useful for categorizing a numeric variable)  

```{r, echo = TRUE, out.width = "500px", fig.align='center'}
ggplot(CO2, aes(x = conc, y = uptake)) + 
  geom_point(aes(color = Type), size = 2.5) +
  facet_wrap(~ Treatment)
```


 Other `ggplot2` Type Plotting

- Saw `pairs`, better with `GGally::ggpairs()`

```{r, echo = TRUE, out.width = "600px", fig.align='center', message = FALSE, warning = FALSE}
library(GGally) #install GGally if needed
ggpairs(iris, aes(colour = Species, alpha = 0.4))
```


 `ggplot2` Plotting: Numerical variables  

Recap!  

Numerical variable - entries are a numerical value where math can be performed

Most common plots:

- Histogram (`geom_hist`), Density (`geom_density`)  

- Boxplot (`geom_boxplot`)

- Scatter plot (`geom_point`), Smoothers (`geom_smooth`)

- Jittered points (`geom_jitter`)  

- Text on plot (`geom_text`)  


 `ggplot2` Plotting Recap

General `ggplot` things:

- Can set local or global `aes`

- Modify titles/labels by adding more layers

- Use either stat or geom layer

- Faceting (multiple plots) via `facet_grid` or `facet_wrap`

- Only need `aes` if setting a mapping value that is dependent on the data (or you want to create a custom legend!)  


 Recap!

`ggplot(data = <DATA>) +`  
&nbsp;&nbsp;`<GEOM_FUNCTION>(mapping = aes(<MAPPINGS>), stat = <STAT>, position = <POSITION>) +`  
&nbsp;&nbsp;`<COORDINATE_FUNCTION> +`  
&nbsp;&nbsp;`<FACET_FUNCTION> +`  
&nbsp;&nbsp;`<LABEL_FUNCTION>`   
`)`

- Lots of extensions to ggplot!  
    + `gganimate`  
    + `ggthemes`  
    + `ggmap`  
    + `ggrepel`
